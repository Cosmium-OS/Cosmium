modules:
  - type: dnf
    repos:
      cleanup: true
      copr:
        - bieszczaders/kernel-cachyos-addons
    install:
      install-weak-deps: false
      packages:
        - iwd
        - adwaita-sans-fonts
        - ModemManager
        - NetworkManager-adsl
        - NetworkManager-openconnect-gnome
        - NetworkManager-openvpn-gnome
        - NetworkManager-ppp
        - NetworkManager-pptp-gnome
        - NetworkManager-ssh-gnome
        - NetworkManager-vpnc-gnome
        - NetworkManager-wwan
        - adobe-source-code-pro-fonts
        - avahi
        - dconf
        - fprintd-pam
        - gdm
        - glib-networking
        - gnome-backgrounds
        - gnome-bluetooth
        - gnome-color-manager
        - gnome-connections
        - gnome-control-center
        - gnome-disk-utility
        - gnome-epub-thumbnailer
        - gnome-initial-setup
        - gnome-remote-desktop
        - gnome-session-wayland-session
        - gnome-settings-daemon
        - gnome-shell
        - gvfs-afc
        - gvfs-afp
        - gvfs-archive
        - gvfs-fuse
        - gvfs-goa
        - gvfs-gphoto2
        - gvfs-mtp
        - gvfs-smb
        - libsane-hpaio
        - localsearch
        - mesa-dri-drivers
        - nautilus
        - polkit
        - ptyxis
        - rygel
        - sane-backends-drivers-scanners
        - systemd-oomd-defaults
        - tinysparql
        - xdg-desktop-portal
        - xdg-desktop-portal-gnome
        - xdg-desktop-portal-gtk
        - xdg-user-dirs-gtk
        - scx-scheds
        - flatpak
    remove:
      auto-remove: false
      packages:
        - kernel
        - kernel-core
        - kernel-modules
        - kernel-modules-core
        - kernel-modules-extra
        - kernel-tools
        - kernel-tools-libs
        - kernel-uki-virt

  - type: script
    snippets:
      - "curl -fsSL https://github.com/terrapkg/subatomic-repos/raw/main/terra.repo | tee /etc/yum.repos.d/terra.repo"

  - type: dnf
    install:
      packages:
        - terra-release

  - type: script
    scripts:
      - bazzite-kernel.sh

  - type: files
    files:
      - source: shared
        destination: /

  - type: dnf
    repos:
      cleanup: true
      files:
        - https://negativo17.org/repos/fedora-steam.repo
        - https://pkgs.tailscale.com/stable/fedora/tailscale.repo
    install:
      install-weak-deps: false
      packages:
        - steam
        - extest.i686
        - tailscale

  - type: dnf
    repos:
      cleanup: true
      copr:
        - bazzite-org/bazzite
        - bazzite-org/bazzite-multilib
        - ublue-os/staging
        - ublue-os/packages
    install:
      packages:
        - repo: copr:copr.fedorainfracloud.org:bazzite-org:bazzite
          packages:
            - ibus
        - bazaar
        - gamescope.x86_64
        - gamescope-libs.x86_64
        - gamescope-libs.i686
        - gamescope-shaders
        - jupiter-sd-mounting-btrfs
        - umu-launcher
        - dbus-x11
        - xdg-user-dirs
        - gobject-introspection
        - libFAudio.x86_64
        - libFAudio.i686
        - vkBasalt.x86_64
        - vkBasalt.i686
        - mangohud.x86_64
        - mangohud.i686
        - desktop-file-utils
        - python3-gobject

  - type: script
    snippets:
      - "dnf5 versionlock add ibus"
